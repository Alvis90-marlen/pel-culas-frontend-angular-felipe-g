<!-- peliculas.component.html -->

<div class="pagina-peliculas">
  <h1>Catálogo de Películas</h1>

  <!-- Botón para administrar películas -->
  <button class="boton-administrar-peliculas" (click)="goToAdmin()">Administrar Películas</button>

  <!-- Controles de búsqueda y ordenamiento -->
  <div class="controles-busqueda-orden">
    <div>
      <label for="buscarTitulo">Buscar por Título:</label>
      <input type="text" id="buscarTitulo" placeholder="Ej: Interstellar" [(ngModel)]="searchText" (input)="aplicarFiltros()">
    </div>
    <div>
      <label for="ordenarPor">Ordenar por:</label>
      <select id="ordenarPor" [(ngModel)]="sortBy" (change)="aplicarFiltros()">
        <option value="">Sin Orden</option>
        <option value="titulo">Título</option>
        <option value="anio">Año</option>
        <option value="director">Director</option>
      </select>
    </div>
    <div>
      <label for="direccionOrden">Dirección:</label>
      <select id="direccionOrden" [(ngModel)]="sortDirection" (change)="aplicarFiltros()">
        <option value="asc">Ascendente</option>
        <option value="desc">Descendente</option>
      </select>
    </div>
  </div>

  <!-- Cuadrícula de películas -->
  <div class="cuadricula-peliculas">
    <div class="tarjeta-pelicula" *ngFor="let pelicula of peliculas">
      <img [src]="pelicula.imagen || 'https://placehold.co/280x250/cccccc/000000?text=Pelicula'" [alt]="pelicula.titulo">
      <h3>{{ pelicula.titulo }}</h3>
      <p>Director: {{ pelicula.director }}</p>
      <p>Año: {{ pelicula.anio }}</p>
      <p>Estado: **{{ pelicula.estado | titlecase }}**</p> <!-- Muestra el estado actual -->
      <div class="grupo-botones">
        <!-- Botón de Alquilar/Devolver -->
        <button
          [ngClass]="{
            'boton-alquilar': pelicula.estado === 'publicada',
            'boton-devolver': pelicula.estado === 'alquilada',
            'boton-deshabilitado': pelicula.estado === 'edicion'
          }"
          [disabled]="pelicula.estado === 'edicion'"
          (click)="alquilarDevolverPelicula(pelicula.id!, pelicula.estado!)">
          {{ pelicula.estado === 'publicada' ? 'Alquilar' : (pelicula.estado === 'alquilada' ? 'Devolver' : 'En Edición') }}
        </button>
        <!-- Botones de Editar y Eliminar (manteniendo la funcionalidad existente) -->
        <button class="boton-editar" (click)="editarPelicula(pelicula.id!)">Editar</button>
        <button class="boton-eliminar" (click)="eliminarPelicula(pelicula.id!)">Eliminar</button>
      </div>
    </div>

    <!-- Mensaje si no hay películas -->
    <div *ngIf="peliculas.length === 0" class="no-peliculas-mensaje">
      <p>No hay películas para mostrar con los filtros actuales.</p>
    </div>
  </div>
</div>
